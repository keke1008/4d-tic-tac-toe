# N-Dimensional Tic-Tac-Toe

**2D～6D+の多次元空間で楽しむ三目並べゲーム**

[![Version](https://img.shields.io/badge/version-3.3.0-blue.svg)](https://github.com/keke1008/4d-tic-tac-toe)

🎮 **[今すぐプレイ！](https://keke1008.github.io/4d-tic-tac-toe/)**

## ✨ 特徴

### 🌌 N次元空間対応
- **2D～6D+**: ゲーム中に自由に次元数を変更可能
- **動的グリッドサイズ**: 3×3×...、4×4×...、5×5×... から選択
- **リアルタイム再構築**: 設定変更時に即座にゲーム空間を再生成

### 🎨 高次元回転の可視化
- **動的回転平面**: N次元空間では C(n,2) 個の回転平面が自動生成
  - 2D: 1平面 (xy)
  - 3D: 3平面 (xy, xz, yz)
  - 4D: 6平面 (xy, xz, xw, yz, yw, zw)
  - 5D: 10平面
  - 6D: 15平面
- **色による次元表現**: 最高次元の座標値により色が変化
- **透視投影**: N次元 → 3D → 2Dの段階的投影

### 📱 完全モバイル対応
- **タッチ操作**: スワイプで回転、タップで配置
- **レスポンシブUI**: スマホ/タブレット/PC完全対応
- **ジェスチャー認識**: ピンチでズーム、2本指でパン

### ⚙️ 高度な設定
- **ランタイム設定変更**: ゲーム中に次元数とグリッドサイズを変更
- **モーダルUI**: 直感的な設定インターフェース
- **情報表示**: 回転平面数、総セル数を自動計算表示

## 🎮 遊び方

### 基本ルール

1. プレイヤー X と O が交互にセルにマークを配置
2. N次元空間で指定数（3/4/5個）を並べたプレイヤーが勝利
3. 全セル埋まると引き分け

### 設定変更

**リセットボタン (🔄)** をクリックすると設定モーダルが開きます：

- **次元数**: 2D～6D（またはそれ以上）
- **グリッドサイズ**: 3目並べ、4目並べ、5目並べ

設定例:
- **2D (4×4)**: 16セル - 平面の三目並べ
- **3D (4×4×4)**: 64セル - 立体の三目並べ
- **4D (4×4×4×4)**: 256セル - 超立方体の三目並べ
- **5D (4×4×4×4×4)**: 1,024セル - 5次元三目並べ
- **6D (4×4×4×4×4×4)**: 4,096セル - 6次元三目並べ

### 操作方法

#### 🖱️ PC
- **ドラッグ**: 選択した回転平面でグリッド回転
- **Shift+ドラッグ**: カメラの平行移動
- **ホイール**: ズームイン/アウト
- **クリック**: セル選択（2回クリックで確定）

#### 📱 モバイル
- **1本指スワイプ**: グリッド回転
- **2本指スワイプ**: カメラ平行移動
- **ピンチ**: ズーム
- **タップ**: セル選択（2回タップで確定）

#### ⚙️ UI コントロール
- **🔄 リセット**: 設定モーダルを開く
- **▶ 自動回転**: 自動回転ON/OFF
- **⚙️ 設定**: 高度な回転軸設定
- **❓ ヘルプ**: 操作方法を表示

### 勝利条件

N次元空間では **3^N - 1** 方向の勝利パターンが存在:

| 次元 | 勝利方向数 | 例 |
|------|-----------|-----|
| 2D | 8 | 縦、横、対角線2本 |
| 3D | 26 | 平面内 + 3D対角線 |
| 4D | 80 | 3D方向 + 4D対角線 |
| 5D | 242 | 4D方向 + 5D対角線 |
| 6D | 728 | 5D方向 + 6D対角線 |

## 🛠️ 技術スタック

### フロントエンド
- **Three.js** (r160): WebGL 3Dレンダリング
- **Hammer.js** (2.0.8): タッチジェスチャー認識
- **ES6 Modules**: モジュール化されたアーキテクチャ

### アーキテクチャ

```
js/
├── main.js              # ゲームオーケストレーター
├── config.js            # 設定・定数
├── mathnd.js            # N次元数学ライブラリ
├── renderer.js          # 3D可視化
├── input.js             # 入力制御
├── game.js              # ゲームボード (GameBoard)
│
├── game/
│   ├── WinChecker.js           # N次元勝利判定
│   └── RotationInitializer.js  # 回転状態初期化
│
├── grid/
│   ├── GridBuilder.js          # N次元グリッド生成
│   └── ConnectionManager.js    # 接続線管理
│
├── rendering/
│   ├── SceneManager.js         # Three.jsシーン管理
│   ├── CameraController.js     # カメラ制御
│   ├── MarkerRenderer.js       # X/Oマーカー描画
│   └── CellAppearanceManager.js # セル外観管理
│
├── input/
│   ├── MouseController.js      # マウス入力
│   ├── GestureHandler.js       # タッチジェスチャー
│   └── UIController.js         # UI操作
│
└── ui/
    ├── SettingsModal.js        # 設定モーダル
    └── UIManager.js            # ステータス表示
```

### 主要機能

#### N次元数学 (`mathnd.js`)
- 動的回転平面生成: `generateRotationPlanes(n)`
- N次元回転: `rotateND(point, rotations, dimensions)`
- 反復投影: `projectNDto3D(point)`

#### 動的ゲームボード (`game.js`)
- **2D-4D**: ネストした配列で高速アクセス
- **5D+**: Map構造でメモリ効率化
- 次元数に応じて自動選択

#### 再帰的生成 (`GridBuilder.js`)
- N次元セル生成: `generateCellsRecursive()`
- N次元接続生成: `generateConnectionsRecursive()`

#### 勝利判定 (`WinChecker.js`)
- 再帰的方向ベクトル生成: `3^n - 1` 方向
- 任意次元の勝利ライン検出

## 🚀 開発

### ローカル実行

```bash
# リポジトリをクローン
git clone https://github.com/keke1008/4d-tic-tac-toe.git
cd 4d-tic-tac-toe

# ローカルサーバー起動
python -m http.server 8000

# ブラウザでアクセス
open http://localhost:8000
```

### ファイル構成

```
4d-tic-tac-toe/
├── index.html           # エントリーポイント
├── css/
│   └── style.css       # スタイルシート
└── js/                 # JavaScriptモジュール (19ファイル)
```

## 📊 バージョン履歴

### v3.3.0 (現在)
- ✅ 設定モーダル実装（次元数・グリッドサイズ変更）
- ✅ UIManager/SettingsModal分離
- ✅ Phase 6リファクタリング: コード重複削除、命名統一

### v3.2.0
- ✅ N次元GridBuilder & 動的回転
- ✅ 5D-6D完全対応

### v3.1.0
- ✅ N次元GameBoard & WinChecker
- ✅ 再帰的勝利判定

### v3.0.0
- ✅ MathND: N次元数学ライブラリ
- ✅ 2D-4D汎用設計

### v2.x
- ✅ UX改善: 2クリック確定、モバイル最適化

### v1.x
- ✅ 初期実装: 4D三目並べ基本機能

## 🎯 技術的ハイライト

### パフォーマンス最適化
- **条件付きストレージ**: 次元数に応じた最適なデータ構造
- **Three.jsリソース管理**: 適切な dispose() 実装
- **イベント委譲**: 効率的なイベント処理

### コード品質
- **責任の分離**: 各クラスが単一責任を持つ
- **モジュール設計**: ES6モジュールで疎結合
- **型安全**: JSDocによる型注釈

### 拡張性
- **N次元対応**: 2次元から任意の高次元まで拡張可能
- **プラグイン可能**: 新しい機能を容易に追加
- **設定駆動**: CONFIG オブジェクトで一元管理

---

**多次元空間での戦略的思考を楽しんでください！** 🌌✨
